<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Syncular — Gravitational Merge</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://api.fontshare.com/v2/css?f[]=satoshi@300,400,500,700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600&display=swap" rel="stylesheet" />
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            display: ['Satoshi', 'system-ui', 'sans-serif'],
            mono: ['"Fira Code"', 'monospace'],
          },
          colors: {
            branch: {
              a: '#60a5fa',
              b: '#4ade80',
              c: '#a78bfa',
            },
            merge: {
              glow: '#fbbf24',
              white: '#ffffff',
            },
            surface: {
              DEFAULT: '#050505',
              raised: '#0a0a0a',
              border: '#1a1a1a',
            },
          },
        },
      },
    };
  </script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      font-family: 'Satoshi', system-ui, sans-serif;
      background: #050505;
      color: #e5e5e5;
      overflow-x: hidden;
    }
    .font-mono { font-family: 'Fira Code', monospace !important; }

    /* Merge glow pulse */
    @keyframes mergeGlow {
      0%, 100% { box-shadow: 0 0 40px 10px rgba(251, 191, 36, 0.15), 0 0 80px 20px rgba(251, 191, 36, 0.05); }
      50% { box-shadow: 0 0 60px 20px rgba(251, 191, 36, 0.25), 0 0 120px 40px rgba(251, 191, 36, 0.1); }
    }
    .merge-glow {
      animation: mergeGlow 3s ease-in-out infinite;
    }

    /* Log line typing */
    @keyframes logFadeIn {
      0% { opacity: 0; transform: translateY(6px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    .log-line {
      opacity: 0;
      animation: logFadeIn 0.3s ease-out forwards;
    }

    /* Subtle float for section headers */
    @keyframes subtleFloat {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-3px); }
    }

    /* Code block styling */
    .code-block {
      background: #0a0a0a;
      border: 1px solid #1a1a1a;
      border-radius: 8px;
      overflow: hidden;
    }
    .code-block pre {
      padding: 1.25rem;
      overflow-x: auto;
      font-size: 0.825rem;
      line-height: 1.7;
    }
    .code-header {
      background: #111;
      border-bottom: 1px solid #1a1a1a;
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
      color: #666;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .code-header .dot {
      width: 8px; height: 8px; border-radius: 50%;
    }

    /* Syntax highlighting */
    .syn-keyword { color: #c084fc; }
    .syn-string { color: #4ade80; }
    .syn-type { color: #60a5fa; }
    .syn-func { color: #fbbf24; }
    .syn-comment { color: #525252; font-style: italic; }
    .syn-number { color: #f97316; }
    .syn-prop { color: #e5e5e5; }
    .syn-punct { color: #737373; }
    .syn-operator { color: #c084fc; }
    .syn-param { color: #f0abfc; }

    /* Comparison table */
    .compare-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2px;
      background: #1a1a1a;
      border-radius: 12px;
      overflow: hidden;
    }
    .compare-cell {
      background: #0a0a0a;
      padding: 1.5rem;
    }
    .compare-header {
      background: #111;
      padding: 1rem 1.5rem;
      font-weight: 600;
    }

    /* Merge visualization */
    .device-card {
      background: #0a0a0a;
      border: 1px solid #1a1a1a;
      border-radius: 12px;
      padding: 1.25rem;
      transition: border-color 0.3s ease;
    }
    .device-card:hover {
      border-color: #333;
    }

    /* Nav glass effect */
    nav {
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }

    /* Canvas container */
    #heroCanvas {
      display: block;
    }

    /* Scroll fade in */
    .fade-section {
      opacity: 0;
      transform: translateY(30px);
      transition: opacity 0.7s ease-out, transform 0.7s ease-out;
    }
    .fade-section.visible {
      opacity: 1;
      transform: translateY(0);
    }
  </style>
</head>
<body>

  <!-- Nav -->
  <nav class="fixed top-0 left-0 right-0 z-50 border-b border-white/5 bg-[#050505]/80">
    <div class="max-w-6xl mx-auto px-6 h-14 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <div class="w-6 h-6 rounded-full bg-gradient-to-br from-branch-a via-branch-c to-merge-glow"></div>
        <span class="font-display font-bold text-white tracking-tight">Syncular</span>
      </div>
      <div class="hidden md:flex items-center gap-8 text-sm text-neutral-400">
        <a href="#protocol" class="hover:text-white transition-colors">Protocol</a>
        <a href="#code" class="hover:text-white transition-colors">Code</a>
        <a href="#merge-viz" class="hover:text-white transition-colors">Merge</a>
        <a href="#install" class="hover:text-white transition-colors">Install</a>
      </div>
      <a href="https://github.com/nicknisi/syncular" class="text-sm text-neutral-400 hover:text-white transition-colors font-mono">
        GitHub &rarr;
      </a>
    </div>
  </nav>

  <!-- Hero -->
  <section class="relative min-h-screen flex flex-col items-center justify-center pt-14">
    <!-- Canvas background -->
    <div class="absolute inset-0">
      <canvas id="heroCanvas" class="w-full h-full"></canvas>
    </div>

    <!-- Content overlay -->
    <div class="relative z-10 text-center px-6 max-w-4xl mx-auto">
      <div class="mb-3">
        <span class="inline-block font-mono text-xs tracking-widest uppercase text-merge-glow/80 bg-merge-glow/5 border border-merge-glow/10 rounded-full px-4 py-1.5">
          Offline-first sync framework
        </span>
      </div>
      <h1 class="font-display font-bold text-4xl sm:text-5xl md:text-6xl lg:text-7xl text-white leading-[1.1] tracking-tight mb-6">
        Every branch finds its way<br/>
        <span class="bg-gradient-to-r from-branch-a via-branch-c to-merge-glow bg-clip-text text-transparent">to the merge</span>
      </h1>
      <p class="text-neutral-400 text-lg md:text-xl max-w-2xl mx-auto leading-relaxed mb-10">
        Like git, but for live data. Offline branches converge through a commit-log protocol with server-ordered merging and zero conflicts.
      </p>
      <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
        <a href="#install" class="px-6 py-3 bg-white text-black font-medium rounded-lg hover:bg-neutral-200 transition-colors text-sm">
          Get started
        </a>
        <a href="#protocol" class="px-6 py-3 border border-white/10 text-white font-medium rounded-lg hover:border-white/25 transition-colors text-sm">
          Read the protocol &darr;
        </a>
      </div>
    </div>

    <!-- Merge log -->
    <div class="relative z-10 mt-12 w-full max-w-3xl mx-auto px-6">
      <div class="code-block">
        <div class="code-header">
          <div class="dot bg-branch-a"></div>
          <div class="dot bg-branch-b"></div>
          <div class="dot bg-branch-c"></div>
          <span class="ml-2">merge-log</span>
        </div>
        <div id="mergeLog" class="font-mono text-xs leading-6 p-4 h-[140px] overflow-hidden">
        </div>
      </div>
    </div>

    <!-- Scroll hint -->
    <div class="relative z-10 mt-12 mb-8 text-neutral-600 text-xs font-mono animate-bounce">
      scroll &darr;
    </div>
  </section>

  <!-- Commit Protocol Comparison -->
  <section id="protocol" class="py-24 px-6 fade-section">
    <div class="max-w-5xl mx-auto">
      <div class="text-center mb-16">
        <span class="font-mono text-xs tracking-widest uppercase text-branch-c mb-3 block">Commit Protocol</span>
        <h2 class="font-display font-bold text-3xl md:text-4xl text-white mb-4">
          The sync protocol you already understand
        </h2>
        <p class="text-neutral-400 max-w-2xl mx-auto">
          If you know git, you know Syncular. Branches, commits, and merges &mdash; but for live application data with automatic server-side ordering.
        </p>
      </div>

      <div class="compare-grid mb-12">
        <div class="compare-header text-neutral-400 flex items-center gap-2">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 16 16"><path d="M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"/></svg>
          Git (code)
        </div>
        <div class="compare-header text-white flex items-center gap-2">
          <div class="w-4 h-4 rounded-full bg-gradient-to-br from-branch-a to-merge-glow"></div>
          Syncular (data)
        </div>

        <!-- Row 1: Branching -->
        <div class="compare-cell">
          <div class="text-sm font-medium text-neutral-300 mb-2">Branches</div>
          <p class="text-xs text-neutral-500 leading-relaxed">
            <code class="text-neutral-400">git checkout -b feature</code><br/>
            Developer creates a branch to work on a feature independently.
          </p>
        </div>
        <div class="compare-cell">
          <div class="text-sm font-medium text-white mb-2">Offline writes</div>
          <p class="text-xs text-neutral-400 leading-relaxed">
            Each client accumulates operations in a local <strong class="text-branch-a">outbox</strong> while offline. Every device is its own branch.
          </p>
        </div>

        <!-- Row 2: Commits -->
        <div class="compare-cell">
          <div class="text-sm font-medium text-neutral-300 mb-2">Commits</div>
          <p class="text-xs text-neutral-500 leading-relaxed">
            <code class="text-neutral-400">git commit -m "add todo"</code><br/>
            A snapshot of staged changes with a hash and message.
          </p>
        </div>
        <div class="compare-cell">
          <div class="text-sm font-medium text-white mb-2">Push commit</div>
          <p class="text-xs text-neutral-400 leading-relaxed">
            Client pushes a commit with <strong class="text-branch-b">clientCommitId</strong>, an array of <strong class="text-branch-b">operations</strong> (table, row_id, op, payload), and a <strong class="text-branch-b">schemaVersion</strong>.
          </p>
        </div>

        <!-- Row 3: Merge -->
        <div class="compare-cell">
          <div class="text-sm font-medium text-neutral-300 mb-2">Pull request &rarr; merge</div>
          <p class="text-xs text-neutral-500 leading-relaxed">
            Open a PR, review diffs, resolve conflicts manually, then merge into main.
          </p>
        </div>
        <div class="compare-cell">
          <div class="text-sm font-medium text-white mb-2">Server-ordered merge</div>
          <p class="text-xs text-neutral-400 leading-relaxed">
            Server assigns a monotonic <strong class="text-merge-glow">commitSeq</strong>, applies operations in order, performs field-level merge, and broadcasts the result. All clients pull the same ordered log.
          </p>
        </div>

        <!-- Row 4: History -->
        <div class="compare-cell">
          <div class="text-sm font-medium text-neutral-300 mb-2">git log</div>
          <p class="text-xs text-neutral-500 leading-relaxed">
            Linear commit history on main after merge.
          </p>
        </div>
        <div class="compare-cell">
          <div class="text-sm font-medium text-white mb-2">Pull with cursor</div>
          <p class="text-xs text-neutral-400 leading-relaxed">
            Clients pull commits using a <strong class="text-branch-c">cursor</strong> (last seen commitSeq). Server returns only new commits &mdash; incremental, scoped, and ordered.
          </p>
        </div>
      </div>

      <!-- Protocol detail cards -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="bg-[#0a0a0a] border border-[#1a1a1a] rounded-xl p-5">
          <div class="font-mono text-xs text-merge-glow mb-2">commitSeq</div>
          <div class="text-sm text-neutral-300 mb-1 font-medium">Server-assigned ordering</div>
          <p class="text-xs text-neutral-500 leading-relaxed">
            Every pushed commit gets a monotonically increasing sequence number. This is the single source of truth for operation order across all clients.
          </p>
        </div>
        <div class="bg-[#0a0a0a] border border-[#1a1a1a] rounded-xl p-5">
          <div class="font-mono text-xs text-branch-a mb-2">scope keys</div>
          <div class="text-sm text-neutral-300 mb-1 font-medium">Subscription filtering</div>
          <p class="text-xs text-neutral-500 leading-relaxed">
            Each operation carries scope values (e.g. <code class="text-branch-a">user_id</code>, <code class="text-branch-a">project_id</code>). Clients subscribe to specific scopes and only receive matching data.
          </p>
        </div>
        <div class="bg-[#0a0a0a] border border-[#1a1a1a] rounded-xl p-5">
          <div class="font-mono text-xs text-branch-b mb-2">base_version</div>
          <div class="text-sm text-neutral-300 mb-1 font-medium">Optimistic concurrency</div>
          <p class="text-xs text-neutral-500 leading-relaxed">
            Operations include the row version they were based on. The server detects conflicts via version mismatch and performs field-level merge or rejects.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Code Examples -->
  <section id="code" class="py-24 px-6 fade-section">
    <div class="max-w-5xl mx-auto">
      <div class="text-center mb-16">
        <span class="font-mono text-xs tracking-widest uppercase text-branch-b mb-3 block">Developer Experience</span>
        <h2 class="font-display font-bold text-3xl md:text-4xl text-white mb-4">
          Real code, real protocol
        </h2>
        <p class="text-neutral-400 max-w-2xl mx-auto">
          Four concepts: define shapes, write offline, subscribe to scoped data, and let the server handle merges.
        </p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

        <!-- Code 1: Define a shape -->
        <div class="code-block">
          <div class="code-header">
            <div class="dot bg-branch-c"></div>
            <span>server/shapes/todos.ts</span>
          </div>
          <pre class="font-mono"><code><span class="syn-comment">// 1. Define a table shape with scope extraction</span>
<span class="syn-keyword">const</span> <span class="syn-prop">todosShape</span> <span class="syn-operator">=</span> <span class="syn-func">createShape</span><span class="syn-punct">&lt;</span><span class="syn-type">DB</span><span class="syn-punct">,</span> <span class="syn-type">SharedScopes</span><span class="syn-punct">&gt;(</span><span class="syn-string">'todos'</span><span class="syn-punct">,</span> <span class="syn-punct">{</span>
  <span class="syn-prop">scopes</span><span class="syn-punct">:</span> <span class="syn-punct">[</span><span class="syn-string">'project:{project_id}'</span><span class="syn-punct">],</span>

  <span class="syn-keyword">async</span> <span class="syn-func">resolveScopes</span><span class="syn-punct">(</span><span class="syn-param">ctx</span><span class="syn-punct">)</span> <span class="syn-punct">{</span>
    <span class="syn-comment">// Access control: which scopes can this actor see?</span>
    <span class="syn-keyword">const</span> <span class="syn-prop">projects</span> <span class="syn-operator">=</span> <span class="syn-keyword">await</span> <span class="syn-func">getProjectsForUser</span><span class="syn-punct">(</span><span class="syn-param">ctx</span><span class="syn-punct">.</span><span class="syn-prop">actorId</span><span class="syn-punct">);</span>
    <span class="syn-keyword">return</span> <span class="syn-punct">{</span> <span class="syn-prop">project_id</span><span class="syn-punct">:</span> <span class="syn-prop">projects</span><span class="syn-punct">.</span><span class="syn-func">map</span><span class="syn-punct">(</span><span class="syn-param">p</span> <span class="syn-operator">=></span> <span class="syn-param">p</span><span class="syn-punct">.</span><span class="syn-prop">id</span><span class="syn-punct">)</span> <span class="syn-punct">};</span>
  <span class="syn-punct">},</span>
<span class="syn-punct">});</span></code></pre>
        </div>

        <!-- Code 2: Write offline -->
        <div class="code-block">
          <div class="code-header">
            <div class="dot bg-branch-a"></div>
            <span>client/actions.ts</span>
          </div>
          <pre class="font-mono"><code><span class="syn-comment">// 2. Write while offline — commits queue in the outbox</span>
<span class="syn-keyword">await</span> <span class="syn-prop">client</span><span class="syn-punct">.</span><span class="syn-func">mutate</span><span class="syn-punct">(</span><span class="syn-keyword">async</span> <span class="syn-punct">(</span><span class="syn-param">trx</span><span class="syn-punct">)</span> <span class="syn-operator">=></span> <span class="syn-punct">{</span>
  <span class="syn-keyword">await</span> <span class="syn-param">trx</span>
    <span class="syn-punct">.</span><span class="syn-func">insertInto</span><span class="syn-punct">(</span><span class="syn-string">'todos'</span><span class="syn-punct">)</span>
    <span class="syn-punct">.</span><span class="syn-func">values</span><span class="syn-punct">({</span>
      <span class="syn-prop">id</span><span class="syn-punct">:</span> <span class="syn-func">crypto.randomUUID</span><span class="syn-punct">(),</span>
      <span class="syn-prop">title</span><span class="syn-punct">:</span> <span class="syn-string">'Ship the feature'</span><span class="syn-punct">,</span>
      <span class="syn-prop">completed</span><span class="syn-punct">:</span> <span class="syn-number">false</span><span class="syn-punct">,</span>
      <span class="syn-prop">project_id</span><span class="syn-punct">:</span> <span class="syn-string">'proj_01'</span><span class="syn-punct">,</span>
    <span class="syn-punct">})</span>
    <span class="syn-punct">.</span><span class="syn-func">execute</span><span class="syn-punct">();</span>
<span class="syn-punct">});</span>

<span class="syn-comment">// Commit pushes automatically when back online</span></code></pre>
        </div>

        <!-- Code 3: Subscribe -->
        <div class="code-block">
          <div class="code-header">
            <div class="dot bg-branch-b"></div>
            <span>client/components/TodoList.tsx</span>
          </div>
          <pre class="font-mono"><code><span class="syn-comment">// 3. Subscribe to scoped data — reactive, offline-ready</span>
<span class="syn-keyword">function</span> <span class="syn-func">TodoList</span><span class="syn-punct">({</span> <span class="syn-param">projectId</span> <span class="syn-punct">}:</span> <span class="syn-punct">{</span> <span class="syn-param">projectId</span><span class="syn-punct">:</span> <span class="syn-type">string</span> <span class="syn-punct">})</span> <span class="syn-punct">{</span>
  <span class="syn-keyword">const</span> <span class="syn-prop">todos</span> <span class="syn-operator">=</span> <span class="syn-func">useQuery</span><span class="syn-punct">(</span>
    <span class="syn-param">db</span> <span class="syn-operator">=></span> <span class="syn-param">db</span>
      <span class="syn-punct">.</span><span class="syn-func">selectFrom</span><span class="syn-punct">(</span><span class="syn-string">'todos'</span><span class="syn-punct">)</span>
      <span class="syn-punct">.</span><span class="syn-func">selectAll</span><span class="syn-punct">()</span>
      <span class="syn-punct">.</span><span class="syn-func">where</span><span class="syn-punct">(</span><span class="syn-string">'project_id'</span><span class="syn-punct">,</span> <span class="syn-string">'='</span><span class="syn-punct">,</span> <span class="syn-param">projectId</span><span class="syn-punct">)</span>
      <span class="syn-punct">.</span><span class="syn-func">orderBy</span><span class="syn-punct">(</span><span class="syn-string">'created_at'</span><span class="syn-punct">,</span> <span class="syn-string">'desc'</span><span class="syn-punct">)</span>
  <span class="syn-punct">);</span>

  <span class="syn-keyword">return</span> <span class="syn-punct">&lt;</span><span class="syn-type">ul</span><span class="syn-punct">&gt;{</span><span class="syn-prop">todos</span><span class="syn-punct">.</span><span class="syn-func">map</span><span class="syn-punct">(</span><span class="syn-param">t</span> <span class="syn-operator">=></span> <span class="syn-punct">&lt;</span><span class="syn-type">li</span><span class="syn-punct">&gt;{</span><span class="syn-param">t</span><span class="syn-punct">.</span><span class="syn-prop">title</span><span class="syn-punct">}&lt;/</span><span class="syn-type">li</span><span class="syn-punct">&gt;)}&lt;/</span><span class="syn-type">ul</span><span class="syn-punct">&gt;;</span>
<span class="syn-punct">}</span></code></pre>
        </div>

        <!-- Code 4: Conflict handling -->
        <div class="code-block">
          <div class="code-header">
            <div class="dot bg-merge-glow"></div>
            <span>server/push handler</span>
          </div>
          <pre class="font-mono"><code><span class="syn-comment">// 4. Server merges automatically — field-level resolution</span>
<span class="syn-comment">//</span>
<span class="syn-comment">// Client A (offline): sets title = "Buy milk"</span>
<span class="syn-comment">// Client B (offline): sets completed = true</span>
<span class="syn-comment">//</span>
<span class="syn-comment">// Both push with base_version: 1</span>
<span class="syn-comment">// Server detects different fields changed →</span>
<span class="syn-comment">//   mergedPayload: { title: "Buy milk", completed: true }</span>
<span class="syn-comment">//   conflicts: 0</span>
<span class="syn-comment">//</span>
<span class="syn-comment">// If SAME field changed → conflict result with</span>
<span class="syn-comment">//   server_row and server_version for client resolution</span>

<span class="syn-keyword">type</span> <span class="syn-type">PushResult</span> <span class="syn-operator">=</span>
  <span class="syn-punct">|</span> <span class="syn-punct">{</span> <span class="syn-prop">status</span><span class="syn-punct">:</span> <span class="syn-string">'applied'</span><span class="syn-punct">;</span>  <span class="syn-prop">commitSeq</span><span class="syn-punct">:</span> <span class="syn-type">number</span> <span class="syn-punct">}</span>
  <span class="syn-punct">|</span> <span class="syn-punct">{</span> <span class="syn-prop">status</span><span class="syn-punct">:</span> <span class="syn-string">'conflict'</span><span class="syn-punct">;</span> <span class="syn-prop">server_row</span><span class="syn-punct">:</span> <span class="syn-type">Row</span> <span class="syn-punct">}</span>
  <span class="syn-punct">|</span> <span class="syn-punct">{</span> <span class="syn-prop">status</span><span class="syn-punct">:</span> <span class="syn-string">'rejected'</span><span class="syn-punct">;</span> <span class="syn-prop">error</span><span class="syn-punct">:</span> <span class="syn-type">string</span> <span class="syn-punct">};</span></code></pre>
        </div>
      </div>
    </div>
  </section>

  <!-- Merge Visualization: "The merge is inevitable" -->
  <section id="merge-viz" class="py-24 px-6 fade-section">
    <div class="max-w-5xl mx-auto">
      <div class="text-center mb-16">
        <span class="font-mono text-xs tracking-widest uppercase text-merge-glow mb-3 block">Convergence</span>
        <h2 class="font-display font-bold text-3xl md:text-4xl text-white mb-4">
          The merge is inevitable
        </h2>
        <p class="text-neutral-400 max-w-2xl mx-auto">
          Three clients go offline with divergent data. They come back online at different times. The server merges them into one consistent state.
        </p>
      </div>

      <!-- Before: Divergent state -->
      <div class="mb-8">
        <div class="flex items-center gap-3 mb-5">
          <div class="w-2 h-2 rounded-full bg-red-400"></div>
          <span class="font-mono text-xs text-red-400 uppercase tracking-widest">Before — divergent branches</span>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="device-card border-branch-a/30">
            <div class="flex items-center gap-2 mb-3">
              <div class="w-3 h-3 rounded-full bg-branch-a"></div>
              <span class="font-mono text-xs text-branch-a">client-a</span>
              <span class="ml-auto font-mono text-[10px] text-neutral-600">offline 4m</span>
            </div>
            <div class="font-mono text-xs space-y-1.5">
              <div class="flex items-center gap-2">
                <span class="text-neutral-600 w-16">INSERT</span>
                <span class="text-neutral-300">todo #t3 "Buy milk"</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="text-neutral-600 w-16">UPDATE</span>
                <span class="text-neutral-300">todo #t1 title="Ship v2"</span>
              </div>
            </div>
            <div class="mt-3 pt-3 border-t border-[#1a1a1a]">
              <span class="font-mono text-[10px] text-neutral-600">outbox: 2 ops &middot; base commitSeq: 42</span>
            </div>
          </div>

          <div class="device-card border-branch-b/30">
            <div class="flex items-center gap-2 mb-3">
              <div class="w-3 h-3 rounded-full bg-branch-b"></div>
              <span class="font-mono text-xs text-branch-b">client-b</span>
              <span class="ml-auto font-mono text-[10px] text-neutral-600">offline 12m</span>
            </div>
            <div class="font-mono text-xs space-y-1.5">
              <div class="flex items-center gap-2">
                <span class="text-neutral-600 w-16">UPDATE</span>
                <span class="text-neutral-300">todo #t1 completed=true</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="text-neutral-600 w-16">DELETE</span>
                <span class="text-neutral-300">todo #t2</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="text-neutral-600 w-16">INSERT</span>
                <span class="text-neutral-300">todo #t4 "Deploy staging"</span>
              </div>
            </div>
            <div class="mt-3 pt-3 border-t border-[#1a1a1a]">
              <span class="font-mono text-[10px] text-neutral-600">outbox: 3 ops &middot; base commitSeq: 42</span>
            </div>
          </div>

          <div class="device-card border-branch-c/30">
            <div class="flex items-center gap-2 mb-3">
              <div class="w-3 h-3 rounded-full bg-branch-c"></div>
              <span class="font-mono text-xs text-branch-c">client-c</span>
              <span class="ml-auto font-mono text-[10px] text-neutral-600">offline 1h</span>
            </div>
            <div class="font-mono text-xs space-y-1.5">
              <div class="flex items-center gap-2">
                <span class="text-neutral-600 w-16">UPDATE</span>
                <span class="text-neutral-300">todo #t1 title="Ship v3"</span>
              </div>
            </div>
            <div class="mt-3 pt-3 border-t border-[#1a1a1a]">
              <span class="font-mono text-[10px] text-neutral-600">outbox: 1 op &middot; base commitSeq: 40</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Arrow -->
      <div class="flex justify-center my-8">
        <div class="flex flex-col items-center gap-2">
          <div class="w-px h-8 bg-gradient-to-b from-transparent via-merge-glow/40 to-merge-glow/80"></div>
          <div class="merge-glow w-10 h-10 rounded-full bg-merge-glow/10 border border-merge-glow/30 flex items-center justify-center">
            <svg class="w-5 h-5 text-merge-glow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/>
            </svg>
          </div>
          <span class="font-mono text-[10px] text-merge-glow/60">server-ordered merge</span>
          <div class="w-px h-8 bg-gradient-to-b from-merge-glow/80 via-merge-glow/40 to-transparent"></div>
        </div>
      </div>

      <!-- After: Converged state -->
      <div>
        <div class="flex items-center gap-3 mb-5">
          <div class="w-2 h-2 rounded-full bg-emerald-400"></div>
          <span class="font-mono text-xs text-emerald-400 uppercase tracking-widest">After — converged state</span>
        </div>
        <div class="code-block">
          <div class="code-header">
            <div class="dot bg-merge-glow"></div>
            <span>server commit log (commitSeq 43-45)</span>
          </div>
          <pre class="font-mono text-xs leading-7 p-5"><code><span class="syn-comment">// commitSeq 43 — client-a pushes first</span>
<span class="syn-punct">{</span> <span class="syn-prop">commitSeq</span><span class="syn-punct">:</span> <span class="syn-number">43</span><span class="syn-punct">,</span> <span class="syn-prop">actorId</span><span class="syn-punct">:</span> <span class="syn-string">'client-a'</span><span class="syn-punct">,</span> <span class="syn-prop">changes</span><span class="syn-punct">:</span> <span class="syn-punct">[</span>
  <span class="syn-punct">{</span> <span class="syn-prop">table</span><span class="syn-punct">:</span> <span class="syn-string">'todos'</span><span class="syn-punct">,</span> <span class="syn-prop">row_id</span><span class="syn-punct">:</span> <span class="syn-string">'t3'</span><span class="syn-punct">,</span> <span class="syn-prop">op</span><span class="syn-punct">:</span> <span class="syn-string">'upsert'</span><span class="syn-punct">,</span> <span class="syn-prop">row_version</span><span class="syn-punct">:</span> <span class="syn-number">1</span> <span class="syn-punct">},</span>
  <span class="syn-punct">{</span> <span class="syn-prop">table</span><span class="syn-punct">:</span> <span class="syn-string">'todos'</span><span class="syn-punct">,</span> <span class="syn-prop">row_id</span><span class="syn-punct">:</span> <span class="syn-string">'t1'</span><span class="syn-punct">,</span> <span class="syn-prop">op</span><span class="syn-punct">:</span> <span class="syn-string">'upsert'</span><span class="syn-punct">,</span> <span class="syn-prop">row_version</span><span class="syn-punct">:</span> <span class="syn-number">2</span> <span class="syn-punct">},</span>  <span class="syn-comment">// title → "Ship v2"</span>
<span class="syn-punct">]}</span>

<span class="syn-comment">// commitSeq 44 — client-b pushes next</span>
<span class="syn-punct">{</span> <span class="syn-prop">commitSeq</span><span class="syn-punct">:</span> <span class="syn-number">44</span><span class="syn-punct">,</span> <span class="syn-prop">actorId</span><span class="syn-punct">:</span> <span class="syn-string">'client-b'</span><span class="syn-punct">,</span> <span class="syn-prop">changes</span><span class="syn-punct">:</span> <span class="syn-punct">[</span>
  <span class="syn-punct">{</span> <span class="syn-prop">table</span><span class="syn-punct">:</span> <span class="syn-string">'todos'</span><span class="syn-punct">,</span> <span class="syn-prop">row_id</span><span class="syn-punct">:</span> <span class="syn-string">'t1'</span><span class="syn-punct">,</span> <span class="syn-prop">op</span><span class="syn-punct">:</span> <span class="syn-string">'upsert'</span><span class="syn-punct">,</span> <span class="syn-prop">row_version</span><span class="syn-punct">:</span> <span class="syn-number">3</span> <span class="syn-punct">},</span>  <span class="syn-comment">// merged: completed=true (no title conflict)</span>
  <span class="syn-punct">{</span> <span class="syn-prop">table</span><span class="syn-punct">:</span> <span class="syn-string">'todos'</span><span class="syn-punct">,</span> <span class="syn-prop">row_id</span><span class="syn-punct">:</span> <span class="syn-string">'t2'</span><span class="syn-punct">,</span> <span class="syn-prop">op</span><span class="syn-punct">:</span> <span class="syn-string">'delete'</span><span class="syn-punct">,</span> <span class="syn-prop">row_version</span><span class="syn-punct">:</span> <span class="syn-number">null</span> <span class="syn-punct">},</span>
  <span class="syn-punct">{</span> <span class="syn-prop">table</span><span class="syn-punct">:</span> <span class="syn-string">'todos'</span><span class="syn-punct">,</span> <span class="syn-prop">row_id</span><span class="syn-punct">:</span> <span class="syn-string">'t4'</span><span class="syn-punct">,</span> <span class="syn-prop">op</span><span class="syn-punct">:</span> <span class="syn-string">'upsert'</span><span class="syn-punct">,</span> <span class="syn-prop">row_version</span><span class="syn-punct">:</span> <span class="syn-number">1</span> <span class="syn-punct">},</span>
<span class="syn-punct">]}</span>

<span class="syn-comment">// commitSeq 45 — client-c pushes last (title conflict with commitSeq 43)</span>
<span class="syn-punct">{</span> <span class="syn-prop">commitSeq</span><span class="syn-punct">:</span> <span class="syn-number">45</span><span class="syn-punct">,</span> <span class="syn-prop">actorId</span><span class="syn-punct">:</span> <span class="syn-string">'client-c'</span><span class="syn-punct">,</span> <span class="syn-prop">status</span><span class="syn-punct">:</span> <span class="syn-string">'conflict'</span><span class="syn-punct">,</span>
  <span class="syn-comment">// client-c based on version 1 but server is now version 3</span>
  <span class="syn-comment">// → server returns { server_row, server_version: 3 } for client resolution</span>
<span class="syn-punct">}</span></code></pre>
        </div>
      </div>

      <!-- Final state summary -->
      <div class="mt-8 grid grid-cols-1 md:grid-cols-4 gap-3">
        <div class="bg-[#0a0a0a] border border-emerald-500/20 rounded-xl p-4 text-center">
          <div class="font-mono text-lg text-white font-bold">t1</div>
          <div class="font-mono text-[10px] text-neutral-500 mt-1">"Ship v2" &middot; completed</div>
          <div class="font-mono text-[10px] text-emerald-400 mt-1">version 3</div>
        </div>
        <div class="bg-[#0a0a0a] border border-neutral-800 rounded-xl p-4 text-center opacity-40">
          <div class="font-mono text-lg text-neutral-400 font-bold line-through">t2</div>
          <div class="font-mono text-[10px] text-neutral-600 mt-1">deleted</div>
        </div>
        <div class="bg-[#0a0a0a] border border-emerald-500/20 rounded-xl p-4 text-center">
          <div class="font-mono text-lg text-white font-bold">t3</div>
          <div class="font-mono text-[10px] text-neutral-500 mt-1">"Buy milk"</div>
          <div class="font-mono text-[10px] text-branch-a mt-1">from client-a</div>
        </div>
        <div class="bg-[#0a0a0a] border border-emerald-500/20 rounded-xl p-4 text-center">
          <div class="font-mono text-lg text-white font-bold">t4</div>
          <div class="font-mono text-[10px] text-neutral-500 mt-1">"Deploy staging"</div>
          <div class="font-mono text-[10px] text-branch-b mt-1">from client-b</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Install -->
  <section id="install" class="py-24 px-6 fade-section">
    <div class="max-w-3xl mx-auto text-center">
      <span class="font-mono text-xs tracking-widest uppercase text-branch-a mb-3 block">Get Started</span>
      <h2 class="font-display font-bold text-3xl md:text-4xl text-white mb-4">
        One install away from gravitational sync
      </h2>
      <p class="text-neutral-400 max-w-xl mx-auto mb-10">
        Add the client and server packages. Define your shapes, wire up the transport, and let the commit log do the rest.
      </p>

      <div class="code-block max-w-lg mx-auto mb-10">
        <div class="code-header">
          <div class="dot bg-branch-b"></div>
          <span>terminal</span>
        </div>
        <pre class="font-mono text-sm p-5 text-left"><code><span class="syn-comment"># Install core packages</span>
<span class="syn-func">bun</span> add @syncular/client @syncular/server

<span class="syn-comment"># Add transport + server adapter</span>
<span class="syn-func">bun</span> add @syncular/transport-http @syncular/server-hono

<span class="syn-comment"># Optional: React bindings</span>
<span class="syn-func">bun</span> add @syncular/client-react</code></pre>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 max-w-2xl mx-auto text-left">
        <div class="bg-[#0a0a0a] border border-[#1a1a1a] rounded-xl p-4">
          <div class="text-sm font-medium text-white mb-1">Offline-first</div>
          <p class="text-xs text-neutral-500 leading-relaxed">
            Full read/write capability while offline. Commits queue in the outbox and push when connectivity returns.
          </p>
        </div>
        <div class="bg-[#0a0a0a] border border-[#1a1a1a] rounded-xl p-4">
          <div class="text-sm font-medium text-white mb-1">Scoped subscriptions</div>
          <p class="text-xs text-neutral-500 leading-relaxed">
            Clients only receive data matching their scope keys. Multi-tenant by default, efficient by design.
          </p>
        </div>
        <div class="bg-[#0a0a0a] border border-[#1a1a1a] rounded-xl p-4">
          <div class="text-sm font-medium text-white mb-1">Field-level merge</div>
          <p class="text-xs text-neutral-500 leading-relaxed">
            Concurrent edits to different fields merge cleanly. Same-field conflicts surface with server state for client resolution.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="py-12 px-6 border-t border-white/5">
    <div class="max-w-5xl mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
      <div class="flex items-center gap-2">
        <div class="w-5 h-5 rounded-full bg-gradient-to-br from-branch-a via-branch-c to-merge-glow"></div>
        <span class="font-display font-bold text-white text-sm">Syncular</span>
        <span class="text-neutral-600 text-xs ml-2">Offline-first sync framework</span>
      </div>
      <div class="flex items-center gap-6 text-xs text-neutral-500 font-mono">
        <a href="#protocol" class="hover:text-white transition-colors">Protocol</a>
        <a href="#code" class="hover:text-white transition-colors">Code</a>
        <a href="#merge-viz" class="hover:text-white transition-colors">Merge</a>
        <span class="text-neutral-700">|</span>
        <span>MIT License</span>
      </div>
    </div>
  </footer>

  <!-- ====================================================================== -->
  <!-- Canvas: Gravitational Commit Graph -->
  <!-- ====================================================================== -->
  <script>
  (function() {
    const canvas = document.getElementById('heroCanvas');
    const ctx = canvas.getContext('2d');

    // Branch colors
    const BRANCH_A = '#60a5fa';
    const BRANCH_B = '#4ade80';
    const BRANCH_C = '#a78bfa';
    const MERGE_GLOW = '#fbbf24';
    const MERGE_WHITE = '#ffffff';

    let W, H;
    let time = 0;
    let dpr = window.devicePixelRatio || 1;

    function resize() {
      const rect = canvas.parentElement.getBoundingClientRect();
      W = rect.width;
      H = rect.height;
      canvas.width = W * dpr;
      canvas.height = H * dpr;
      canvas.style.width = W + 'px';
      canvas.style.height = H + 'px';
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }

    window.addEventListener('resize', resize);
    resize();

    // Merge point position
    function mergeX() { return W * 0.72; }
    function mergeY() { return H * 0.42; }

    // Branch Y offsets (spread on left, converge on right)
    const branchConfigs = [
      { color: BRANCH_A, yOffset: -0.12, spread: 0.15 },
      { color: BRANCH_B, yOffset: 0.0,   spread: 0.0  },
      { color: BRANCH_C, yOffset: 0.12,  spread: -0.15 },
    ];

    // Gravitational curve: branches curve toward merge point
    function branchY(branchIndex, x) {
      const cfg = branchConfigs[branchIndex];
      const mx = mergeX();
      const my = mergeY();

      // Left side: spaced out
      const startY = my + cfg.yOffset * H;

      if (x >= mx) {
        return my; // After merge, single line
      }

      // Progress toward merge (0 at left edge, 1 at merge)
      const leftEdge = W * 0.08;
      const t = Math.max(0, Math.min(1, (x - leftEdge) / (mx - leftEdge)));

      // Gravitational curve: accelerates as it approaches merge
      // Use a power curve for gravitational feel
      const gravity = Math.pow(t, 2.5);

      return startY + (my - startY) * gravity;
    }

    // Commit dots
    class Commit {
      constructor(branchIndex) {
        this.branchIndex = branchIndex;
        this.x = -Math.random() * W * 0.3;
        this.speed = 0.4 + Math.random() * 0.3;
        this.baseSpeed = this.speed;
        this.size = 2 + Math.random() * 2;
        this.opacity = 0.6 + Math.random() * 0.4;
        this.merged = false;
        this.trail = [];
      }

      update() {
        const mx = mergeX();
        const dist = mx - this.x;

        if (this.x < mx) {
          // Gravitational acceleration: speed increases as distance decreases
          const gravityFactor = 1 + Math.pow(Math.max(0, 1 - dist / (W * 0.5)), 3) * 4;
          this.speed = this.baseSpeed * gravityFactor;
        } else {
          // After merge, steady speed
          this.speed = this.baseSpeed * 1.5;
          this.merged = true;
        }

        this.x += this.speed;

        // Trail
        const y = this.getY();
        this.trail.push({ x: this.x, y: y });
        if (this.trail.length > 8) this.trail.shift();

        // Reset when off screen
        if (this.x > W + 50) {
          this.x = -Math.random() * 100 - 20;
          this.merged = false;
          this.trail = [];
          this.speed = this.baseSpeed;
        }
      }

      getY() {
        return branchY(this.branchIndex, this.x);
      }

      draw() {
        const y = this.getY();
        const cfg = branchConfigs[this.branchIndex];
        const color = this.merged ? MERGE_WHITE : cfg.color;

        // Trail
        if (this.trail.length > 1) {
          for (let i = 1; i < this.trail.length; i++) {
            const alpha = (i / this.trail.length) * 0.15 * this.opacity;
            ctx.beginPath();
            ctx.arc(this.trail[i].x, this.trail[i].y, this.size * 0.6, 0, Math.PI * 2);
            ctx.fillStyle = color;
            ctx.globalAlpha = alpha;
            ctx.fill();
          }
        }

        // Glow near merge
        const mx = mergeX();
        const dist = Math.abs(this.x - mx);
        if (dist < 80) {
          const glowAlpha = (1 - dist / 80) * 0.4 * this.opacity;
          ctx.beginPath();
          ctx.arc(this.x, y, this.size * 4, 0, Math.PI * 2);
          const grd = ctx.createRadialGradient(this.x, y, 0, this.x, y, this.size * 4);
          grd.addColorStop(0, color);
          grd.addColorStop(1, 'transparent');
          ctx.fillStyle = grd;
          ctx.globalAlpha = glowAlpha;
          ctx.fill();
        }

        // Dot
        ctx.beginPath();
        ctx.arc(this.x, y, this.size, 0, Math.PI * 2);
        ctx.fillStyle = color;
        ctx.globalAlpha = this.opacity;
        ctx.fill();

        ctx.globalAlpha = 1;
      }
    }

    // Create commits
    const commits = [];
    for (let b = 0; b < 3; b++) {
      for (let i = 0; i < 12; i++) {
        const c = new Commit(b);
        c.x = -Math.random() * W * 1.2;
        commits.push(c);
      }
    }

    // Background stars (subtle)
    const stars = [];
    for (let i = 0; i < 80; i++) {
      stars.push({
        x: Math.random() * 2000,
        y: Math.random() * 1200,
        size: Math.random() * 1.2,
        opacity: Math.random() * 0.3 + 0.05,
        twinkleSpeed: 0.5 + Math.random() * 2,
      });
    }

    function drawStars() {
      for (const s of stars) {
        const twinkle = 0.5 + 0.5 * Math.sin(time * s.twinkleSpeed);
        ctx.beginPath();
        ctx.arc(s.x % W, s.y % H, s.size, 0, Math.PI * 2);
        ctx.fillStyle = '#ffffff';
        ctx.globalAlpha = s.opacity * twinkle;
        ctx.fill();
      }
      ctx.globalAlpha = 1;
    }

    function drawBranchLines() {
      const leftEdge = W * 0.08;
      const mx = mergeX();
      const my = mergeY();
      const rightEdge = W + 10;

      for (let b = 0; b < 3; b++) {
        const cfg = branchConfigs[b];

        ctx.beginPath();
        ctx.moveTo(0, branchY(b, 0));

        // Draw curved branch
        for (let x = 0; x <= mx; x += 3) {
          ctx.lineTo(x, branchY(b, x));
        }

        ctx.strokeStyle = cfg.color;
        ctx.globalAlpha = 0.12;
        ctx.lineWidth = 1.5;
        ctx.stroke();
      }

      // Merged line (after merge point)
      ctx.beginPath();
      ctx.moveTo(mx, my);
      ctx.lineTo(rightEdge, my);
      ctx.strokeStyle = MERGE_WHITE;
      ctx.globalAlpha = 0.15;
      ctx.lineWidth = 1.5;
      ctx.stroke();

      ctx.globalAlpha = 1;
    }

    function drawMergePoint() {
      const mx = mergeX();
      const my = mergeY();
      const pulse = 0.5 + 0.5 * Math.sin(time * 1.5);

      // Outer glow
      const outerR = 50 + pulse * 20;
      const grd1 = ctx.createRadialGradient(mx, my, 0, mx, my, outerR);
      grd1.addColorStop(0, 'rgba(251, 191, 36, 0.12)');
      grd1.addColorStop(0.5, 'rgba(251, 191, 36, 0.03)');
      grd1.addColorStop(1, 'transparent');
      ctx.beginPath();
      ctx.arc(mx, my, outerR, 0, Math.PI * 2);
      ctx.fillStyle = grd1;
      ctx.fill();

      // Mid glow
      const midR = 20 + pulse * 8;
      const grd2 = ctx.createRadialGradient(mx, my, 0, mx, my, midR);
      grd2.addColorStop(0, 'rgba(255, 255, 255, 0.25)');
      grd2.addColorStop(0.5, 'rgba(251, 191, 36, 0.1)');
      grd2.addColorStop(1, 'transparent');
      ctx.beginPath();
      ctx.arc(mx, my, midR, 0, Math.PI * 2);
      ctx.fillStyle = grd2;
      ctx.fill();

      // Core
      ctx.beginPath();
      ctx.arc(mx, my, 3 + pulse * 1.5, 0, Math.PI * 2);
      ctx.fillStyle = MERGE_WHITE;
      ctx.globalAlpha = 0.8 + pulse * 0.2;
      ctx.fill();
      ctx.globalAlpha = 1;

      // Spacetime distortion rings
      for (let i = 0; i < 3; i++) {
        const ringR = 30 + i * 25 + Math.sin(time * 0.8 + i) * 5;
        ctx.beginPath();
        ctx.ellipse(mx, my, ringR, ringR * 0.3, 0.2, 0, Math.PI * 2);
        ctx.strokeStyle = MERGE_GLOW;
        ctx.globalAlpha = 0.04 - i * 0.01;
        ctx.lineWidth = 1;
        ctx.stroke();
      }

      ctx.globalAlpha = 1;
    }

    // Grid distortion near merge (subtle background grid that warps)
    function drawWarpGrid() {
      const mx = mergeX();
      const my = mergeY();
      const gridSpacing = 40;

      ctx.globalAlpha = 0.025;
      ctx.strokeStyle = '#ffffff';
      ctx.lineWidth = 0.5;

      // Horizontal lines
      for (let y = 0; y < H; y += gridSpacing) {
        ctx.beginPath();
        for (let x = 0; x < W; x += 4) {
          const dx = x - mx;
          const dy = y - my;
          const dist = Math.sqrt(dx * dx + dy * dy);
          const warpStrength = Math.max(0, 1 - dist / 250);
          const warpY = y + (my - y) * warpStrength * 0.3;
          if (x === 0) ctx.moveTo(x, warpY);
          else ctx.lineTo(x, warpY);
        }
        ctx.stroke();
      }

      // Vertical lines
      for (let x = 0; x < W; x += gridSpacing) {
        ctx.beginPath();
        for (let y = 0; y < H; y += 4) {
          const dx = x - mx;
          const dy = y - my;
          const dist = Math.sqrt(dx * dx + dy * dy);
          const warpStrength = Math.max(0, 1 - dist / 250);
          const warpX = x + (mx - x) * warpStrength * 0.3;
          if (y === 0) ctx.moveTo(warpX, y);
          else ctx.lineTo(warpX, y);
        }
        ctx.stroke();
      }

      ctx.globalAlpha = 1;
    }

    function animate() {
      time += 0.016;
      ctx.clearRect(0, 0, W, H);

      // Background
      ctx.fillStyle = '#050505';
      ctx.fillRect(0, 0, W, H);

      drawStars();
      drawWarpGrid();
      drawBranchLines();
      drawMergePoint();

      // Update and draw commits
      for (const c of commits) {
        c.update();
        c.draw();
      }

      requestAnimationFrame(animate);
    }

    animate();
  })();
  </script>

  <!-- ====================================================================== -->
  <!-- Merge Log Animation -->
  <!-- ====================================================================== -->
  <script>
  (function() {
    const logEl = document.getElementById('mergeLog');
    const branches = [
      { name: 'client-a', color: '#60a5fa' },
      { name: 'client-b', color: '#4ade80' },
      { name: 'client-c', color: '#a78bfa' },
    ];
    const tables = ['todos', 'projects', 'comments', 'users', 'attachments'];
    const ops = ['INSERT', 'UPDATE', 'UPDATE', 'UPDATE', 'DELETE', 'INSERT'];

    function randomHex(len) {
      let s = '';
      const chars = '0123456789abcdef';
      for (let i = 0; i < len; i++) s += chars[Math.floor(Math.random() * 16)];
      return s;
    }

    function pad(str, len) {
      return str.padEnd(len, ' ');
    }

    let lineCount = 0;
    const maxLines = 6;
    let pendingCommits = [];

    function addLine(html) {
      const div = document.createElement('div');
      div.className = 'log-line';
      div.style.animationDelay = '0s';
      div.innerHTML = html;
      logEl.appendChild(div);
      lineCount++;
      if (lineCount > maxLines) {
        const first = logEl.firstChild;
        if (first) logEl.removeChild(first);
      }
    }

    function emitCommitPair() {
      const b1 = branches[Math.floor(Math.random() * branches.length)];
      const b2 = branches[Math.floor(Math.random() * branches.length)];
      const t = tables[Math.floor(Math.random() * tables.length)];
      const op1 = ops[Math.floor(Math.random() * ops.length)];
      const op2 = ops[Math.floor(Math.random() * ops.length)];
      const h1 = randomHex(4);
      const h2 = randomHex(4);
      const conflicts = Math.random() > 0.85 ? 1 : 0;

      pendingCommits.push({
        type: 'commit',
        html: `<span style="color:#525252">branch:</span> <span style="color:${b1.color}">${pad(b1.name, 10)}</span> <span style="color:#525252">commit:</span> <span style="color:#737373">${h1}..</span>  <span style="color:#525252">table:</span> <span style="color:#e5e5e5">${pad(t, 12)}</span> <span style="color:#525252">op:</span> <span style="color:${op1 === 'DELETE' ? '#f87171' : op1 === 'INSERT' ? '#4ade80' : '#fbbf24'}">${op1}</span>`
      });

      pendingCommits.push({
        type: 'commit',
        html: `<span style="color:#525252">branch:</span> <span style="color:${b2.color}">${pad(b2.name, 10)}</span> <span style="color:#525252">commit:</span> <span style="color:#737373">${h2}..</span>  <span style="color:#525252">table:</span> <span style="color:#e5e5e5">${pad(t, 12)}</span> <span style="color:#525252">op:</span> <span style="color:${op2 === 'DELETE' ? '#f87171' : op2 === 'INSERT' ? '#4ade80' : '#fbbf24'}">${op2}</span>`
      });

      const conflictColor = conflicts > 0 ? '#f87171' : '#4ade80';
      const conflictText = conflicts > 0 ? `<span style="color:#f87171">${conflicts}</span>` : `<span style="color:#4ade80">0</span>`;

      pendingCommits.push({
        type: 'merge',
        html: `<span style="color:#fbbf24">\u2192 merge:</span> <span style="color:${conflicts > 0 ? '#f87171' : '#4ade80'}">${conflicts > 0 ? 'conflict' : 'resolved'}</span>  <span style="color:#525252">order:</span> <span style="color:#737373">[${h1}, ${h2}]</span>  <span style="color:#525252">conflicts:</span> ${conflictText}`
      });
    }

    // Initial batch
    emitCommitPair();
    emitCommitPair();

    let tickIndex = 0;

    function tick() {
      if (pendingCommits.length === 0) {
        emitCommitPair();
      }

      const item = pendingCommits.shift();
      if (item) {
        addLine(item.html);
      }

      const delay = item && item.type === 'merge' ? 1800 : 600 + Math.random() * 400;
      setTimeout(tick, delay);
    }

    // Start after a short delay
    setTimeout(tick, 800);
  })();
  </script>

  <!-- ====================================================================== -->
  <!-- Scroll fade-in observer -->
  <!-- ====================================================================== -->
  <script>
  (function() {
    const sections = document.querySelectorAll('.fade-section');
    const observer = new IntersectionObserver((entries) => {
      for (const entry of entries) {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      }
    }, { threshold: 0.1 });

    for (const s of sections) observer.observe(s);

    // Fallback: ensure all sections become visible after 3s
    // (covers headless browsers, broken observers, fast scrollers)
    setTimeout(() => {
      for (const s of sections) s.classList.add('visible');
    }, 3000);
  })();
  </script>

</body>
</html>